<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SANKALPA - A Divine Meeting Place</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        /* SANKALPA COLOR PALETTE (RADIANCE & DIVINITY) */
        :root {
            --primary-a: #E45826; /* Deep Burnt Orange (Flame/Energy) */
            --secondary-b: #F79724; /* Vibrant Flame Orange (Glow/Accent) */
            --text-color-dark: #4E342E; /* Deep Earthy Brown (Maroon/Om tone) */
            --background-base: #FFF8E1; /* Lightest Cream/Saffron Hint */
            --card-background: #FFFFFF; /* Pure white for high contrast and clean glow */
            --subtle-border: #E0B28D; /* Soft gold/tan border */
        }

        body {
            background-color: var(--background-base);
            color: var(--text-color-dark);
            font-family: 'Lato', sans-serif; /* Clean, modern body font for readability */
            min-height: 100vh;
            /* Divine Radiance Glow Effect */
            background-image: radial-gradient(circle at 50% 10%, #FFECD2, var(--background-base) 70%);
            padding-top: 56px;
        }

        /* --- NAVIGATION BAR STYLING --- */
        .navbar-sankalpa {
            background-color: var(--card-background);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .navbar-brand img {
            height: 35px;
            /* Optional: Add a subtle glow to the logo itself */
            filter: drop-shadow(0 0 5px rgba(247, 151, 36, 0.3));
        }

        .nav-link-sankalpa {
            color: var(--text-color-dark) !important;
            font-weight: 600;
            transition: color 0.2s ease;
        }

        .nav-link-sankalpa:hover {
            color: var(--primary-a) !important;
        }

        /* --- ETHNIC/PROMINENT FONT FOR HEADER --- */
        .sankalpa-header {
            font-family: 'Cinzel', serif; /* Powerful, classic, and ethnic-looking serif font */
            font-weight: 900; /* Extra bold */
            color: var(--primary-a); /* Use the flame color for prominence */
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
        }

        .lead-sankalpa {
            color: var(--text-color-dark); 
            font-weight: 700;
        }
        
        .sub-header {
            font-family: 'Cinzel', serif;
            font-weight: 700;
            color: var(--text-color-dark);
            margin-bottom: 1.5rem;
        }

        /* --- FORM CARD STYLING --- */
        .auth-card {
            background-color: var(--card-background); 
            border: 1px solid var(--subtle-border); 
            border-radius: 1.5rem; 
            /* Enhanced Shadow for Divine Glow */
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.15), 0 0 40px rgba(247, 151, 36, 0.15); 
            padding: 2rem;
        }

        /* BUTTONS and INPUTS (Radiance Retained) */
        .btn-primary-sankalpa {
            background-color: var(--primary-a);
            border: none;
            box-shadow: 0 4px 15px rgba(228, 88, 38, 0.4); 
            transition: all 0.2s ease-in-out;
            font-weight: 700;
        }
        .btn-primary-sankalpa:hover {
            background-color: var(--secondary-b); 
            box-shadow: 0 6px 20px rgba(247, 151, 36, 0.6); 
            transform: translateY(-2px);
        }
        .btn-secondary-sankalpa {
            color: var(--primary-a); 
            border: 2px solid var(--primary-a); 
            background-color: transparent;
            font-weight: 600;
        }
        
        /* Input focus is subtle orange glow */
        .form-control:focus {
            border-color: var(--secondary-b);
            box-shadow: 0 0 0 0.25rem rgba(247, 151, 36, 0.2); 
        }

        /* Hard Refresh Notice */
        .refresh-notice {
            background-color: var(--background-base);
            border-top: 2px solid var(--subtle-border);
            color: var(--text-color-dark);
            padding: 0.5rem 0;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-sankalpa fixed-top">
        <div class="container-fluid">
            
            <a class="navbar-brand" href="index.html">
                <img src="Images/Sankalpa_Logo.jpg" alt="Sankalpa Logo" height="35">
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link nav-link-sankalpa" href="contact.html">Contact Us</a>
                    </li>
                    <li class="nav-item d-lg-none">
                        <button class="btn btn-secondary-sankalpa w-100 my-1" type="button" onclick="showExisting()">Existing User</button>
                        <button class="btn btn-primary-sankalpa w-100 my-1" type="button" onclick="showNew()">New User</button>
                    </li>
                </ul>
                
                <div class="d-none d-lg-flex gap-2">
                    <button class="btn btn-secondary-sankalpa" type="button" onclick="showExisting()">Existing User</button>
                    <button class="btn btn-primary-sankalpa" type="button" onclick="showNew()">New User</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container hero-section">
        <div class="row align-items-center">

            <div class="col-lg-7 col-md-12 mb-5 mb-lg-0">
                <h1 class="display-3 sankalpa-header mb-3">
                    SANKALPA
                </h1>
                <p class="lead lead-sankalpa mb-4">
                    The Sacred Registry of Intent and Devotion.
                </p>
                
                <h2 class="sub-header mt-5">Why Sankalpa?</h2>
                <p>
                    A **Sankalpa** is a deep, sacred vow—a resolute intention of the heart and mind. Our platform is the bridge between your inner resolve and its divine manifestation.
                </p>
                <p>
                    This is more than a registry; it is a **divine meeting place**. We are dedicated to the principle that a clear intention, when supported by knowledgeable counsel, yields profound spiritual results. Here, **devotees meet revered Priests**, ensuring every vow is ritually sound and guided by time-honored spiritual wisdom.
                </p>
                <p>
                    By documenting your spiritual journey with us, you create a focused path, illuminated by devotion and clarity, allowing your **Sankalpa** to blossom into reality.
                </p>
            </div>

            <div class="col-lg-5 col-md-12">
                <div class="auth-card">
                    
                    <div id="duplicateMsg">Loading...</div>

                    <div id="existingSection" style="display: block;">
                        <h4 class="sub-header text-center">Enter the Sacred Space</h4>
                        <form onsubmit="event.preventDefault(); loginUser();">
                            
                            <div class="mb-3">
                                <label for="existing_name" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="existing_name" placeholder="Enter your name" required>
                            </div>

                            <div class="row g-3">
                                <div class="col-5">
                                    <label for="existing_country" class="form-label">Country</label>
                                    <select class="form-select" id="existing_country" onchange="handleCountryChange('existing')" required>
                                        <option value="" selected>Select</option>
                                        <option value="India" data-code="+91">India</option>
                                        <option value="USA" data-code="+1">USA</option>
                                    </select>
                                </div>
                                <div class="col-2">
                                    <label for="existing_countryCode" class="form-label">Code</label>
                                    <input type="text" class="form-control" id="existing_countryCode" readonly>
                                </div>
                                <div class="col-5">
                                    <label for="existing_phone" class="form-label">Mobile Number</label>
                                    <input type="number" class="form-control" id="existing_phone" placeholder="Mobile Number" required>
                                </div>
                            </div>

                            <div class="d-grid mt-4">
                                <button type="submit" class="btn btn-primary-sankalpa btn-lg">Log In</button>
                            </div>
                        </form>
                    </div> 

                    <div id="newSection" style="display: none;">
                        <h4 class="sub-header text-center">Register Your Divine Vow</h4>
                        <form onsubmit="event.preventDefault(); registerUser();">
                            
                            <div class="mb-3">
                                <label for="new_name" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="new_name" placeholder="Enter your full name" required>
                            </div>

                            <div class="mb-3">
                                <label for="new_city" class="form-label">City</label>
                                <input type="text" class="form-control" id="new_city" placeholder="Your City Name" required>
                            </div>

                            <div class="row g-3">
                                <div class="col-5">
                                    <label for="new_country" class="form-label">Country</label>
                                    <select class="form-select" id="new_country" onchange="handleCountryChange('new')" required>
                                        <option value="" selected>Select</option>
                                        <option value="India" data-code="+91">India</option>
                                        <option value="USA" data-code="+1">USA</option>
                                    </select>
                                </div>
                                <div class="col-2">
                                    <label for="new_countryCode" class="form-label">Code</label>
                                    <input type="text" class="form-control" id="new_countryCode" readonly>
                                </div>
                                <div class="col-5">
                                    <label for="new_phone" class="form-label">Mobile Number</label>
                                    <input type="number" class="form-control" id="new_phone" placeholder="Mobile Number" required>
                                </div>
                            </div>

                            <div class="d-grid mt-4">
                                <button type="submit" class="btn btn-primary-sankalpa btn-lg">Register Now</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="text-center refresh-notice mt-5">
        <div class="container-fluid">
            <small>If changes aren't visible, please perform a **Hard Refresh**: **Ctrl + Shift + R** (Windows/Linux) or **Cmd + Shift + R** (Mac).</small>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        /***********************************************
         * SANKALPA – script.js (Functionality Preserved)
         ***********************************************/

        const API_URL =
            "https://script.google.com/macros/s/AKfycbzbNeL0HERxq-Q2mXchTEL3iWCM9PYBJFHTor9ViUjzKRyu3EGqqHJXiTyXXbBgt7IQ/exec";

        function goHome() {
            window.location.href = "index.html";
        }

        function showExisting() {
            hideDuplicate();
            document.getElementById("existingSection").style.display = "block";
            document.getElementById("newSection").style.display = "none";
        }

        function showNew() {
            hideDuplicate();
            document.getElementById("existingSection").style.display = "none";
            document.getElementById("newSection").style.display = "block";
        }

        function hideDuplicate() {
            const box = document.getElementById("duplicateMsg");
            if (box) box.style.display = "none";
        }

        function handleCountryChange(type) {
            const selectEl = document.getElementById(type + "_country");
            const codeEl = document.getElementById(type + "_countryCode");
            const selectedOption = selectEl.options[selectEl.selectedIndex];
            const dialCode = selectedOption.getAttribute("data-code");
            codeEl.value = dialCode ? dialCode : "";
        }

        function encodeForm(data) {
            return Object.keys(data)
                .map(
                    (key) =>
                        encodeURIComponent(key) + "=" + encodeURIComponent(data[key])
                )
                .join("&");
        }

        async function loginUser() {
            hideDuplicate();
            const name = document.getElementById("existing_name").value.trim();
            const country = document.getElementById("existing_country").value.trim();
            const code = document.getElementById("existing_countryCode").value.trim();
            const phone = document.getElementById("existing_phone").value.trim();
            if (!name || !country || !phone) {
                showDuplicate("Please fill all fields.");
                return;
            }
            const fullPhone = code + phone;
            const body = encodeForm({
                action: "registerCustomer",
                name: name,
                country: country,
                mobile: fullPhone,
                city: "",
                email: ""
            });

            try {
                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: body
                });

                const data = await response.json();

                if (data.status === "duplicate") {
                    showDuplicate(`Welcome back, ${data.name}. Redirecting…`);
                    setTimeout(() => {
                        window.location.href =
                            "search.html?name=" + encodeURIComponent(data.name);
                    }, 1500);
                } else if (data.status === "success") {
                    showDuplicate(`Welcome, ${name}. Redirecting…`);
                    setTimeout(() => {
                        window.location.href =
                            "search.html?name=" + encodeURIComponent(name);
                    }, 1500);
                } else {
                    showDuplicate("User not found. Please register.");
                }
            } catch (err) {
                showDuplicate("Network issue. Please refresh and try again.");
            }
        }

        async function registerUser() {
            hideDuplicate();
            const name = document.getElementById("new_name").value.trim();
            const country = document.getElementById("new_country").value.trim();
            const code = document.getElementById("new_countryCode").value.trim();
            const phone = document.getElementById("new_phone").value.trim();
            const city = document.getElementById("new_city").value.trim();

            if (!name || !country || !phone || !city) {
                showDuplicate("Please fill all fields.");
                return;
            }
            const fullPhone = code + phone;

            const body = encodeForm({
                action: "registerCustomer",
                name: name,
                country: country,
                mobile: fullPhone,
                city: city,
                email: ""
            });

            try {
                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: body
                });

                const data = await response.json();

                if (data.status === "duplicate") {
                    showDuplicate(
                        `This mobile number is already registered. Welcome back, ${data.name}.`
                    );
                    setTimeout(() => {
                        window.location.href =
                            "search.html?name=" + encodeURIComponent(data.name);
                    }, 1500);
                } else if (data.status === "success") {
                    showDuplicate("Registration successful! Redirecting…");
                    setTimeout(() => {
                        window.location.href =
                            "search.html?name=" + encodeURIComponent(name);
                    }, 1500);
                } else {
                    showDuplicate("Unexpected error during registration.");
                }
            } catch (err) {
                showDuplicate("Network issue. Please refresh and try again.");
            }
        }

        function showDuplicate(msg) {
            const box = document.getElementById("duplicateMsg");
            if (box) {
                box.textContent = msg;
                box.style.display = "block";
            }
        }
    </script>
</body>
</html>
