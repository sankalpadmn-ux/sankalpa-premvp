<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SANKALPA - Connecting with Purpose</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tinos:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        /* SANKALPA COLOR PALETTE (RADIANCE & DIVINITY) */
        :root {
            --primary-a: #E45826; /* Deep Burnt Orange (Flame/Energy) */
            --secondary-b: #F79724; /* Vibrant Flame Orange (Glow/Accent) */
            --text-color-dark: #4E342E; /* Deep Earthy Brown (Maroon/Om tone) */
            --background-base: #FFF8E1; /* Lightest Cream/Saffron Hint */
            --card-background: #FFFFFF; /* Pure white for high contrast and clean glow */
            --subtle-border: #D4A77D; /* Soft gold/tan border */
            --golden-glow-light: #FFFAE9; /* Near white golden highlight */
        }

        body {
            background-color: var(--background-base);
            color: var(--text-color-dark);
            font-family: 'Lato', sans-serif;
            min-height: 100vh;
            /* GOLDEN FLOW BACKGROUND: Subtle radial glow for a soft gold effect */
            background-image: radial-gradient(circle at 50% 10%, var(--golden-glow-light) 0%, var(--background-base) 70%);
            padding-top: 56px;
        }

        /* --- NAVIGATION BAR STYLING: MERGED LOOK --- */
        .navbar-sankalpa {
            /* Navbar is slightly transparent and blurred to merge with background */
            background-color: rgba(255, 255, 255, 0.85); 
            backdrop-filter: blur(5px); 
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border-bottom: 1px solid var(--subtle-border); 
        }

        .navbar-brand img {
            height: 35px;
            /* Logo glow applied */
            filter: drop-shadow(0 0 5px rgba(247, 151, 36, 0.3));
        }
        
        /* --- ETHNIC/PROMINENT FONT FOR HEADER (Tinos - Devanagari Style) --- */
        .sankalpa-header {
            font-family: 'Tinos', serif; /* Devanagari-inspired font */
            font-weight: 700;
            color: var(--primary-a);
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
            font-size: 3.5rem; /* Large size */
        }

        .tagline-sankalpa {
            font-family: 'Tinos', serif;
            color: var(--text-color-dark); 
            font-weight: 400;
            font-size: 1.5rem;
            margin-top: -15px; /* Pull closer to the main heading */
        }
        
        .sub-header {
            font-family: 'Tinos', serif;
            font-weight: 700;
            color: var(--text-color-dark);
            margin-bottom: 1rem;
        }

        /* --- FORM CARD STYLING --- */
        .auth-card {
            background-color: var(--card-background); 
            border: 1px solid var(--subtle-border); 
            border-radius: 1.5rem; 
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.15), 0 0 40px rgba(247, 151, 36, 0.15); 
            padding: 2rem;
            position: relative;
        }
        
        /* Toggle buttons inside the card */
        .toggle-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        /* Set active toggle button styling */
        .btn-toggle-active {
            background-color: var(--primary-a) !important;
            color: white !important;
        }
        
        .btn-toggle-inactive {
            background-color: transparent !important;
            color: var(--primary-a) !important;
            border: 2px solid var(--primary-a);
        }

        /* BUTTONS and INPUTS */
        .btn-primary-sankalpa {
            background-color: var(--primary-a);
            border: none;
            box-shadow: 0 4px 15px rgba(228, 88, 38, 0.4); 
            font-weight: 700;
        }
        
        /* Hard Refresh Notice */
        .refresh-notice {
            background-color: var(--background-base);
            border-top: 2px solid var(--subtle-border);
            color: var(--text-color-dark);
            padding: 0.5rem 0;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-sankalpa fixed-top">
        <div class="container-fluid">
            
            <a class="navbar-brand" href="index.html">
                <img src="images/Sankalpa_Logo.jpg" alt="Sankalpa Logo" height="35">
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link nav-link-sankalpa" href="contact.html">Contact Us</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container hero-section">
        <div class="row align-items-center">

            <div class="col-lg-7 col-md-12 mb-5 mb-lg-0">
                <h1 class="sankalpa-header mb-0">
                    SANKALPA
                </h1>
                <p class="tagline-sankalpa mb-4">
                    Connecting with Purpose
                </p>
                
                <h2 class="sub-header mt-5">Why Sankalpa?</h2>
                <p>
                    Sankalpa is your warm welcome to ancient faith. We simply and beautifully connect you to **trusted priests across the world**.
                </p>
                <p>
                    Using seamless technology, we ensure your sacred **rituals are always authentic**, and your spiritual **vows are realized** with total integrity.
                </p>
            </div>

            <div class="col-lg-5 col-md-12">
                <div class="auth-card">
                    
                    <h4 class="sub-header text-center">Enter the Sacred Space</h4>

                    <div class="toggle-buttons">
                        <button id="existingToggle" class="btn btn-sm btn-toggle-active" type="button" onclick="showExisting()">Existing User</button>
                        <button id="newToggle" class="btn btn-sm btn-toggle-inactive" type="button" onclick="showNew()">New User</button>
                    </div>

                    <div id="duplicateMsg" class="mb-4" style="display: none;">Loading...</div>

                    <div id="existingSection" style="display: block;">
                        <form onsubmit="event.preventDefault(); loginUser();">
                            
                            <div class="mb-3">
                                <label for="existing_name" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="existing_name" placeholder="Enter your name" required>
                            </div>

                            <div class="row g-3">
                                <div class="col-5">
                                    <label for="existing_country" class="form-label">Country</label>
                                    <select class="form-select" id="existing_country" onchange="handleCountryChange('existing')" required>
                                        <option value="" selected>Select</option>
                                        <option value="India" data-code="+91">India</option>
                                        <option value="USA" data-code="+1">USA</option>
                                    </select>
                                </div>
                                <div class="col-2">
                                    <label for="existing_countryCode" class="form-label">Code</label>
                                    <input type="text" class="form-control" id="existing_countryCode" readonly>
                                </div>
                                <div class="col-5">
                                    <label for="existing_phone" class="form-label">Mobile Number</label>
                                    <input type="number" class="form-control" id="existing_phone" placeholder="Mobile Number" required>
                                </div>
                            </div>

                            <div class="d-grid mt-4">
                                <button type="submit" class="btn btn-primary-sankalpa btn-lg">Log In</button>
                            </div>
                        </form>
                    </div> 

                    <div id="newSection" style="display: none;">
                        <h4 class="sub-header text-center">Register Your Divine Vow</h4>
                        <form onsubmit="event.preventDefault(); registerUser();">
                            
                            <div class="mb-3">
                                <label for="new_name" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="new_name" placeholder="Enter your full name" required>
                            </div>

                            <div class="mb-3">
                                <label for="new_city" class="form-label">City</label>
                                <input type="text" class="form-control" id="new_city" placeholder="Your City Name" required>
                            </div>

                            <div class="row g-3">
                                <div class="col-5">
                                    <label for="new_country" class="form-label">Country</label>
                                    <select class="form-select" id="new_country" onchange="handleCountryChange('new')" required>
                                        <option value="" selected>Select</option>
                                        <option value="India" data-code="+91">India</option>
                                        <option value="USA" data-code="+1">USA</option>
                                    </select>
                                </div>
                                <div class="col-2">
                                    <label for="new_countryCode" class="form-label">Code</label>
                                    <input type="text" class="form-control" id="new_countryCode" readonly>
                                </div>
                                <div class="col-5">
                                    <label for="new_phone" class="form-label">Mobile Number</label>
                                    <input type="number" class="form-control" id="new_phone" placeholder="Mobile Number" required>
                                </div>
                            </div>

                            <div class="d-grid mt-4">
                                <button type="submit" class="btn btn-primary-sankalpa btn-lg">Submit</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="text-center refresh-notice mt-5">
        <div class="container-fluid">
            <small>If changes aren't visible, please perform a **Hard Refresh**: **Ctrl + Shift + R** (Windows/Linux) or **Cmd + Shift + R** (Mac).</small>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        /***********************************************
         * SANKALPA – script.js (Functionality Preserved)
         ***********************************************/

        const API_URL =
            "https://script.google.com/macros/s/AKfycbzbNeL0HERxq-Q2mXchTEL3iWCM9PYBJFHTor9ViUjzKRyu3EGqqHJXiTyXXbBgt7IQ/exec";

        function updateToggleButtons(activeId, inactiveId) {
            document.getElementById(activeId + 'Toggle').classList.add('btn-toggle-active');
            document.getElementById(activeId + 'Toggle').classList.remove('btn-toggle-inactive');
            document.getElementById(inactiveId + 'Toggle').classList.add('btn-toggle-inactive');
            document.getElementById(inactiveId + 'Toggle').classList.remove('btn-toggle-active');
        }

        function goHome() {
            window.location.href = "index.html";
        }

        function showExisting() {
            hideDuplicate();
            // Show Existing, Hide New
            document.getElementById("existingSection").style.display = "block";
            document.getElementById("newSection").style.display = "none";
            updateToggleButtons('existing', 'new');
        }

        function showNew() {
            hideDuplicate();
            // Show New, Hide Existing
            document.getElementById("existingSection").style.display = "none";
            document.getElementById("newSection").style.display = "block";
            updateToggleButtons('new', 'existing');
        }

        // Initialize state on page load (ensures correct styling immediately)
        document.addEventListener('DOMContentLoaded', () => {
            showExisting();
        });


        function hideDuplicate() {
            const box = document.getElementById("duplicateMsg");
            if (box) box.style.display = "none";
        }

        function handleCountryChange(type) {
            const selectEl = document.getElementById(type + "_country");
            const codeEl = document.getElementById(type + "_countryCode");
            const selectedOption = selectEl.options[selectEl.selectedIndex];
            const dialCode = selectedOption.getAttribute("data-code");
            codeEl.value = dialCode ? dialCode : "";
        }

        function encodeForm(data) {
            return Object.keys(data)
                .map(
                    (key) =>
                        encodeURIComponent(key) + "=" + encodeURIComponent(data[key])
                )
                .join("&");
        }

        async function loginUser() {
            hideDuplicate();
            const name = document.getElementById("existing_name").value.trim();
            const country = document.getElementById("existing_country").value.trim();
            const code = document.getElementById("existing_countryCode").value.trim();
            const phone = document.getElementById("existing_phone").value.trim();
            if (!name || !country || !phone) {
                showDuplicate("Please fill all fields.");
                return;
            }
            const fullPhone = code + phone;
            const body = encodeForm({
                action: "registerCustomer",
                name: name,
                country: country,
                mobile: fullPhone,
                city: "",
                email: ""
            });

            try {
                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: body
                });

                const data = await response.json();

                if (data.status === "duplicate") {
                    showDuplicate(`Welcome back, ${data.name}. Redirecting…`);
                    setTimeout(() => {
                        window.location.href =
                            "search.html?name=" + encodeURIComponent(data.name);
                    }, 1500);
                } else if (data.status === "success") {
                    showDuplicate(`Welcome, ${name}. Redirecting…`);
                    setTimeout(() => {
                        window.location.href =
                            "search.html?name=" + encodeURIComponent(name);
                    }, 1500);
                } else {
                    showDuplicate("User not found. Please register.");
                }
            } catch (err) {
                showDuplicate("Network issue. Please refresh and try again.");
            }
        }

        async function registerUser() {
            hideDuplicate();
            const name = document.getElementById("new_name").value.trim();
            const country = document.getElementById("new_country").value.trim();
            const code = document.getElementById("new_countryCode").value.trim();
            const phone = document.getElementById("new_phone").value.trim();
            const city = document.getElementById("new_city").value.trim();

            if (!name || !country || !phone || !city) {
                showDuplicate("Please fill all fields.");
                return;
            }
            const fullPhone = code + phone;

            const body = encodeForm({
                action: "registerCustomer",
                name: name,
                country: country,
                mobile: fullPhone,
                city: city,
                email: ""
            });

            try {
                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: body
                });

                const data = await response.json();

                if (data.status === "duplicate") {
                    showDuplicate(
                        `This mobile number is already registered. Welcome back, ${data.name}.`
                    );
                    setTimeout(() => {
                        window.location.href =
                            "search.html?name=" + encodeURIComponent(data.name);
                    }, 1500);
                } else if (data.status === "success") {
                    showDuplicate("Registration successful! Redirecting…");
                    setTimeout(() => {
                        window.location.href =
                            "search.html?name=" + encodeURIComponent(name);
                    }, 1500);
                } else {
                    showDuplicate("Unexpected error during registration.");
                }
            } catch (err) {
                showDuplicate("Network issue. Please refresh and try again.");
            }
        }

        function showDuplicate(msg) {
            const box = document.getElementById("duplicateMsg");
            if (box) {
                box.textContent = msg;
                box.style.display = "block";
            }
        }
    </script>
</body>
</html>
