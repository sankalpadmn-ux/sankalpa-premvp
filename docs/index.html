<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SANKALPA - A Divine Meeting Place</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lora:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* SANKALPA COLOR PALETTE (RADIANCE & DIVINITY) */
        :root {
            --primary-a: #E45826; /* Deep Burnt Orange (Main Logo Color) */
            --secondary-b: #F79724; /* Vibrant Flame Orange (Glow/Accent) */
            --text-color-dark: #6D4C41; /* Dark Brown/Maroon */
            --background-base: #FAEBD7; /* Very Pale Peach/Cream */
            --card-background: #FFFFFF; /* Pure white for high contrast and clean glow */
        }

        body {
            background-color: var(--background-base);
            color: var(--text-color-dark);
            font-family: 'Lora', serif;
            min-height: 100vh;
            /* Divine Radiance Glow Effect */
            background-image: radial-gradient(circle at 50% 10%, #FFECD2, var(--background-base) 70%);
            padding-top: 56px; /* Space for fixed navbar */
        }

        /* --- NAVIGATION BAR STYLING --- */
        .navbar-sankalpa {
            background-color: var(--card-background);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .navbar-brand img {
            height: 35px; /* Size for the navbar logo */
            transition: opacity 0.3s;
        }
        
        /* Optional: Add a subtle lift/glow effect on logo hover */
        .navbar-brand:hover img {
            opacity: 0.9;
        }

        .nav-link-sankalpa {
            color: var(--text-color-dark) !important;
            font-weight: 600;
            margin-right: 1rem;
            transition: color 0.2s ease;
        }

        .nav-link-sankalpa:hover {
            color: var(--primary-a) !important;
        }

        /* --- CONTENT & FORM STYLING (Retained) --- */
        .hero-section {
            padding: 5rem 0;
        }

        .sankalpa-header {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            color: var(--text-color-dark);
        }

        .lead-sankalpa {
            color: var(--primary-a); 
            font-style: italic;
            font-weight: 400;
        }

        .auth-card {
            background-color: var(--card-background); 
            border: 1px solid #F0E0D0; 
            border-radius: 1.5rem; 
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.15), 0 0 40px rgba(247, 151, 36, 0.1); 
            padding: 2rem;
        }

        .h4 {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            color: var(--text-color-dark);
            margin-bottom: 1.5rem;
        }
        
        .btn-primary-sankalpa {
            background-color: var(--primary-a);
            border: none;
            box-shadow: 0 4px 15px rgba(228, 88, 38, 0.4); 
            transition: all 0.2s ease-in-out;
        }
        .btn-primary-sankalpa:hover {
            background-color: var(--secondary-b); 
            box-shadow: 0 6px 20px rgba(247, 151, 36, 0.6); 
            transform: translateY(-2px);
        }
        .btn-secondary-sankalpa {
            color: var(--primary-a); 
            border: 2px solid var(--primary-a); 
            background-color: transparent;
        }
        .btn-secondary-sankalpa:hover {
            color: white;
            background-color: var(--primary-a);
        }
        .form-control:focus {
            border-color: var(--secondary-b);
            box-shadow: 0 0 0 0.25rem rgba(247, 151, 36, 0.2); 
        }

        #duplicateMsg {
            background-color: var(--secondary-b);
            color: white;
            box-shadow: 0 4px 15px rgba(247, 151, 36, 0.4); 
            border-radius: 0.75rem;
            padding: 1.25rem;
            margin-top: 1.5rem;
            text-align: center;
            display: none;
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-sankalpa fixed-top">
        <div class="container-fluid">
            
            <a class="navbar-brand" href="index.html">
                <img src="Docs/Images/Sankalpa_Logo.jpg" alt="Sankalpa Logo" height="35">
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link nav-link-sankalpa" href="contact.html">Contact Us</a>
                    </li>
                    <li class="nav-item d-lg-none">
                        <button class="btn btn-secondary-sankalpa w-100 my-1" type="button" onclick="showExisting()">Existing User</button>
                        <button class="btn btn-primary-sankalpa w-100 my-1" type="button" onclick="showNew()">New User</button>
                    </li>
                </ul>
                
                <div class="d-none d-lg-flex gap-2">
                    <button class="btn btn-secondary-sankalpa" type="button" onclick="showExisting()">Existing User</button>
                    <button class="btn btn-primary-sankalpa" type="button" onclick="showNew()">New User</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container hero-section">
        <div class="row align-items-center">

            <div class="col-lg-7 col-md-12 mb-5 mb-lg-0">
                <h1 class="display-5 sankalpa-header mb-3">
                    Discover Your Divine Sankalpa
                </h1>
                <p class="lead lead-sankalpa mb-4">
                    A sacred space where intention meets enlightenment.
                </p>
                <p>
                    Sankalpa is more than a registry; it is a **divine meeting place** where the spiritual seeker finds guidance and clarity. Here, **devotees get to meet revered Priests**, ensuring every ritual and intention is aligned with the highest spiritual principles.
                </p>
                <p>
                    Our platform is built upon the timeless wisdom of connecting inner resolve—the Sankalpa—with the actions needed to manifest it. By documenting your spiritual intentions, we help you create a clear path for growth, supported by personalized guidance from our devoted clergy.
                </p>
                <p class="text-muted small mt-4">
                    "When the heart is pure, the path appears clear."
                </p>
            </div>

            <div class="col-lg-5 col-md-12">
                <div class="auth-card">
                    
                    <div id="duplicateMsg">Loading...</div>

                    <div id="existingSection" style="display: block;">
                        <h4 class="text-center">Log In to Fulfill Your Intention</h4>
                        <form onsubmit="event.preventDefault(); loginUser();">
                            
                            <div class="mb-3">
                                <label for="existing_name" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="existing_name" placeholder="Enter your name" required>
                            </div>

                            <div class="row g-3">
                                <div class="col-5">
                                    <label for="existing_country" class="form-label">Country</label>
                                    <select class="form-select" id="existing_country" onchange="handleCountryChange('existing')" required>
                                        <option value="" selected>Select</option>
                                        <option value="India" data-code="+91">India</option>
                                        <option value="USA" data-code="+1">USA</option>
                                    </select>
                                </div>
                                <div class="col-2">
                                    <label for="existing_countryCode" class="form-label">Code</label>
                                    <input type="text" class="form-control" id="existing_countryCode" readonly>
                                </div>
                                <div class="col-5">
                                    <label for="existing_phone" class="form-label">Mobile Number</label>
                                    <input type="number" class="form-control" id="existing_phone" placeholder="Mobile Number" required>
                                </div>
                            </div>

                            <div class="d-grid mt-4">
                                <button type="submit" class="btn btn-primary-sankalpa btn-lg">Log In</button>
                            </div>
                        </form>
                    </div> 

                    <div id="newSection" style="display: none;">
                        <h4 class="text-center">Register Your Divine Sankalpa</h4>
                        <form onsubmit="event.preventDefault(); registerUser();">
                            
                            <div class="mb-3">
                                <label for="new_name" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="new_name" placeholder="Enter your full name" required>
                            </div>

                            <div class="mb-3">
                                <label for="new_city" class="form-label">City</label>
                                <input type="text" class="form-control" id="new_city" placeholder="Your City Name" required>
                            </div>

                            <div class="row g-3">
                                <div class="col-5">
                                    <label for="new_country" class="form-label">Country</label>
                                    <select class="form-select" id="new_country" onchange="handleCountryChange('new')" required>
                                        <option value="" selected>Select</option>
                                        <option value="India" data-code="+91">India</option>
                                        <option value="USA" data-code="+1">USA</option>
                                    </select>
                                </div>
                                <div class="col-2">
                                    <label for="new_countryCode" class="form-label">Code</label>
                                    <input type="text" class="form-control" id="new_countryCode" readonly>
                                </div>
                                <div class="col-5">
                                    <label for="new_phone" class="form-label">Mobile Number</label>
                                    <input type="number" class="form-control" id="new_phone" placeholder="Mobile Number" required>
                                </div>
                            </div>

                            <div class="d-grid mt-4">
                                <button type="submit" class="btn btn-primary-sankalpa btn-lg">Register Now</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        /***********************************************
         * SANKALPA – script.js (Functionality Preserved)
         ***********************************************/

        const API_URL =
            "https://script.google.com/macros/s/AKfycbzbNeL0HERxq-Q2mXchTEL3iWCM9PYBJFHTor9ViUjzKRyu3EGqqHJXiTyXXbBgt7IQ/exec";

        /* All functions (goHome, showExisting, showNew, hideDuplicate, 
           handleCountryChange, encodeForm, loginUser, registerUser, showDuplicate) 
           are preserved to ensure Google Sheets connectivity is SAFE. */

        function goHome() {
            window.location.href = "index.html";
        }

        function showExisting() {
            hideDuplicate();
            document.getElementById("existingSection").style.display = "block";
            document.getElementById("newSection").style.display = "none";
        }

        function showNew() {
            hideDuplicate();
            document.getElementById("existingSection").style.display = "none";
            document.getElementById("newSection").style.display = "block";
        }

        function hideDuplicate() {
            const box = document.getElementById("duplicateMsg");
            if (box) box.style.display = "none";
        }

        function handleCountryChange(type) {
            const selectEl = document.getElementById(type + "_country");
            const codeEl = document.getElementById(type + "_countryCode");
            const selectedOption = selectEl.options[selectEl.selectedIndex];
            const dialCode = selectedOption.getAttribute("data-code");
            codeEl.value = dialCode ? dialCode : "";
        }

        function encodeForm(data) {
            return Object.keys(data)
                .map(
                    (key) =>
                        encodeURIComponent(key) + "=" + encodeURIComponent(data[key])
                )
                .join("&");
        }

        async function loginUser() {
            hideDuplicate();
            const name = document.getElementById("existing_name").value.trim();
            const country = document.getElementById("existing_country").value.trim();
            const code = document.getElementById("existing_countryCode").value.trim();
            const phone = document.getElementById("existing_phone").value.trim();
            if (!name || !country || !phone) {
                showDuplicate("Please fill all fields.");
                return;
            }
            const fullPhone = code + phone;
            const body = encodeForm({
                action: "registerCustomer",
                name: name,
                country: country,
                mobile: fullPhone,
                city: "",
                email: ""
            });

            try {
                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: body
                });

                const data = await response.json();

                if (data.status === "duplicate") {
                    showDuplicate(`Welcome back, ${data.name}. Redirecting…`);
                    setTimeout(() => {
                        window.location.href =
                            "search.html?name=" + encodeURIComponent(data.name);
                    }, 1500);
                } else if (data.status === "success") {
                    showDuplicate(`Welcome, ${name}. Redirecting…`);
                    setTimeout(() => {
                        window.location.href =
                            "search.html?name=" + encodeURIComponent(name);
                    }, 1500);
                } else {
                    showDuplicate("User not found. Please register.");
                }
            } catch (err) {
                showDuplicate("Network issue. Please refresh and try again.");
            }
        }

        async function registerUser() {
            hideDuplicate();
            const name = document.getElementById("new_name").value.trim();
            const country = document.getElementById("new_country").value.trim();
            const code = document.getElementById("new_countryCode").value.trim();
            const phone = document.getElementById("new_phone").value.trim();
            const city = document.getElementById("new_city").value.trim();

            if (!name || !country || !phone || !city) {
                showDuplicate("Please fill all fields.");
                return;
            }
            const fullPhone = code + phone;

            const body = encodeForm({
                action: "registerCustomer",
                name: name,
                country: country,
                mobile: fullPhone,
                city: city,
                email: ""
            });

            try {
                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: body
                });

                const data = await response.json();

                if (data.status === "duplicate") {
                    showDuplicate(
                        `This mobile number is already registered. Welcome back, ${data.name}.`
                    );
                    setTimeout(() => {
                        window.location.href =
                            "search.html?name=" + encodeURIComponent(data.name);
                    }, 1500);
                } else if (data.status === "success") {
                    showDuplicate("Registration successful! Redirecting…");
                    setTimeout(() => {
                        window.location.href =
                            "search.html?name=" + encodeURIComponent(name);
                    }, 1500);
                } else {
                    showDuplicate("Unexpected error during registration.");
                }
            } catch (err) {
                showDuplicate("Network issue. Please refresh and try again.");
            }
        }

        function showDuplicate(msg) {
            const box = document.getElementById("duplicateMsg");
            if (box) {
                box.textContent = msg;
                box.style.display = "block";
            }
        }
    </script>
</body>
</html>
