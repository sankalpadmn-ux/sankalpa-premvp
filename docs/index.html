<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SANKALPA - Connecting with Purpose</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lora:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* SANKALPA COLOR PALETTE (Refined for Divine Feel) */
        :root {
            --primary-a: #E45826; /* Deep Burnt Orange (Logo text) */
            --secondary-b: #F79724; /* Vibrant Flame Orange (Logo accent/glow) */
            --text-color-dark: #6D4C41; /* Dark Brown/Maroon (Deepest Om tone) */
            --text-color-light: #8B7163; /* Lighter brown for subtle text */
            --background-base: #FAEBD7; /* Very Pale Peach (Logo background) */
            --background-highlight: #FFF8EE; /* Lighter cream for subtle contrast */
            --border-light: #E0C7AA; /* Soft, warm border color */
        }

        body {
            background-color: var(--background-base);
            color: var(--text-color-dark);
            font-family: 'Lora', serif; /* A more elegant and readable serif font */
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-x: hidden; /* Prevent horizontal scroll on small screens */
        }

        .container {
            max-width: 900px; /* Wider container for a more spacious feel */
        }

        .card {
            background-color: var(--background-highlight); /* Lighter card background */
            border: 1px solid var(--border-light); /* Soft, subtle border */
            border-radius: 1.5rem; /* More rounded corners for softness */
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.08); /* Deeper, softer shadow */
            padding: 3rem; /* More internal padding */
        }

        .sankalpa-header {
            font-family: 'Playfair Display', serif; /* Luxurious font for main title */
            font-weight: 700;
            color: var(--text-color-dark);
            cursor: pointer;
            letter-spacing: 1px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.05); /* Subtle text shadow */
        }

        .lead-sankalpa {
            color: var(--primary-a); /* Use primary color for tagline */
            font-family: 'Lora', serif;
            font-style: italic;
            font-weight: 400;
        }

        .h4 {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            color: var(--text-color-dark);
            margin-bottom: 2rem;
        }

        /* PRIMARY BUTTONS (Submit, Save) */
        .btn-primary-sankalpa {
            background: linear-gradient(135deg, var(--primary-a) 0%, var(--secondary-b) 100%); /* Soft gradient */
            border: none;
            color: white;
            font-weight: 700;
            padding: 0.75rem 2rem;
            border-radius: 0.75rem; /* Slightly less rounded for elegance */
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            box-shadow: 0 5px 15px rgba(228, 88, 38, 0.3); /* Button shadow */
        }

        .btn-primary-sankalpa:hover, .btn-primary-sankalpa:focus {
            transform: translateY(-2px); /* Lift effect on hover */
            box-shadow: 0 8px 20px rgba(228, 88, 38, 0.4);
            background: linear-gradient(135deg, var(--secondary-b) 0%, var(--primary-a) 100%); /* Subtle gradient shift on hover */
            color: white; /* Ensure text remains white */
        }

        /* SECONDARY BUTTONS (Toggle sections) */
        .btn-secondary-sankalpa {
            color: var(--text-color-dark);
            border: 2px solid var(--border-light);
            background-color: transparent;
            font-weight: 600;
            padding: 0.6rem 1.5rem;
            border-radius: 0.75rem;
            transition: all 0.2s ease-in-out;
        }

        .btn-secondary-sankalpa:hover {
            color: var(--primary-a);
            border-color: var(--primary-a);
            background-color: rgba(228, 88, 38, 0.05); /* Very light highlight */
        }

        /* INPUT FIELDS */
        .form-control {
            border: 1px solid var(--border-light);
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            color: var(--text-color-dark);
            background-color: #fcfcfc; /* Slightly off-white for fields */
        }

        .form-control::placeholder {
            color: var(--text-color-light); /* Lighter placeholder text */
            opacity: 0.7;
        }

        .form-control:focus {
            border-color: var(--secondary-b);
            box-shadow: 0 0 0 0.25rem rgba(247, 151, 36, 0.15); /* Softer focus shadow */
            background-color: #ffffff;
        }

        .form-label {
            color: var(--text-color-dark);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        /* DUPLICATE/INFO BOX (Success/Error Messages) */
        #duplicateMsg {
            display: none;
            background-color: var(--secondary-b);
            color: white;
            font-weight: bold;
            border-radius: 0.75rem;
            padding: 1.25rem;
            margin-top: 1.5rem;
            text-align: center;
            animation: fadeIn 0.5s ease-out; /* Subtle fade-in */
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Custom select arrow for consistent look */
        .form-select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%236D4C41' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
            background-position: right 0.75rem center;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8 col-xl-7"> <div class="card">
                    
                    <div class="text-center mb-5"> <h1 class="display-4 sankalpa-header" onclick="goHome()">SANKALPA</h1>
                        <p class="lead lead-sankalpa">Connecting with purpose</p>
                    </div>

                    <div class="d-flex justify-content-center mb-4 gap-3">
                        <button class="btn btn-secondary-sankalpa" type="button" onclick="showExisting()">Existing User</button>
                        <button class="btn btn-secondary-sankalpa" type="button" onclick="showNew()">New User Registration</button>
                    </div>

                    <div id="duplicateMsg" style="display: none;">
                        Loading...
                    </div>

                    <div id="existingSection" style="display: block;">
                        <h4 class="text-center">Welcome Back</h4>
                        <form onsubmit="event.preventDefault(); loginUser();">
                            
                            <div class="mb-3">
                                <label for="existing_name" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="existing_name" placeholder="Enter your name" required>
                            </div>

                            <div class="row g-3"> <div class="col-5">
                                    <label for="existing_country" class="form-label">Country</label>
                                    <select class="form-select" id="existing_country" onchange="handleCountryChange('existing')" required>
                                        <option value="" selected>Select</option>
                                        <option value="India" data-code="+91">India</option>
                                        <option value="USA" data-code="+1">USA</option>
                                        </select>
                                </div>
                                <div class="col-2">
                                    <label for="existing_countryCode" class="form-label">Code</label>
                                    <input type="text" class="form-control" id="existing_countryCode" readonly>
                                </div>
                                <div class="col-5">
                                    <label for="existing_phone" class="form-label">Mobile Number</label>
                                    <input type="number" class="form-control" id="existing_phone" placeholder="Mobile Number" required>
                                </div>
                            </div>

                            <div class="d-grid mt-4">
                                <button type="submit" class="btn btn-primary-sankalpa btn-lg">Log In / Check Status</button>
                            </div>
                        </form>
                    </div> 
                    <div id="newSection" style="display: none;">
                        <h4 class="text-center">New Registration</h4>
                        <form onsubmit="event.preventDefault(); registerUser();">
                            
                            <div class="mb-3">
                                <label for="new_name" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="new_name" placeholder="Enter your full name" required>
                            </div>

                            <div class="mb-3">
                                <label for="new_city" class="form-label">City</label>
                                <input type="text" class="form-control" id="new_city" placeholder="Your City Name" required>
                            </div>

                            <div class="row g-3"> <div class="col-5">
                                    <label for="new_country" class="form-label">Country</label>
                                    <select class="form-select" id="new_country" onchange="handleCountryChange('new')" required>
                                        <option value="" selected>Select</option>
                                        <option value="India" data-code="+91">India</option>
                                        <option value="USA" data-code="+1">USA</option>
                                        </select>
                                </div>
                                <div class="col-2">
                                    <label for="new_countryCode" class="form-label">Code</label>
                                    <input type="text" class="form-control" id="new_countryCode" readonly>
                                </div>
                                <div class="col-5">
                                    <label for="new_phone" class="form-label">Mobile Number</label>
                                    <input type="number" class="form-control" id="new_phone" placeholder="Mobile Number" required>
                                </div>
                            </div>

                            <div class="d-grid mt-4">
                                <button type="submit" class="btn btn-primary-sankalpa btn-lg">Register Now</button>
                            </div>
                        </form>
                    </div>
                    </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        /***********************************************
         * SANKALPA – script.js (Final Stable Version)
         * Form-encoded POST → ALWAYS WORKS with Apps Script
         * No JSON, No CORS, No caching issues
         ***********************************************/

        const API_URL =
            "https://script.google.com/macros/s/AKfycbzbNeL0HERxq-Q2mXchTEL3iWCM9PYBJFHTor9ViUjzKRyu3EGqqHJXiTyXXbBgt7IQ/exec";

        /*---------------------------------------------------
         NAVIGATION
        ---------------------------------------------------*/
        function goHome() {
            window.location.href = "index.html";
        }

        /*---------------------------------------------------
         TOGGLE SECTIONS
        ---------------------------------------------------*/
        function showExisting() {
            hideDuplicate();
            document.getElementById("existingSection").style.display = "block";
            document.getElementById("newSection").style.display = "none";
        }

        function showNew() {
            hideDuplicate();
            document.getElementById("existingSection").style.display = "none";
            document.getElementById("newSection").style.display = "block";
        }

        function hideDuplicate() {
            const box = document.getElementById("duplicateMsg");
            if (box) box.style.display = "none";
        }

        /*---------------------------------------------------
         COUNTRY CODE HANDLER
        ---------------------------------------------------*/
        function handleCountryChange(type) {
            const selectEl = document.getElementById(type + "_country");
            const codeEl = document.getElementById(type + "_countryCode");

            const selectedOption = selectEl.options[selectEl.selectedIndex];
            const dialCode = selectedOption.getAttribute("data-code");

            codeEl.value = dialCode ? dialCode : "";
        }

        /*---------------------------------------------------
         FORM ENCODING – Apps Script Compatible
        ---------------------------------------------------*/
        function encodeForm(data) {
            return Object.keys(data)
                .map(
                    (key) =>
                        encodeURIComponent(key) + "=" + encodeURIComponent(data[key])
                )
                .join("&");
        }

        /*---------------------------------------------------
         EXISTING USER LOGIN
        ---------------------------------------------------*/
        async function loginUser() {
            hideDuplicate();

            const name = document.getElementById("existing_name").value.trim();
            const country = document.getElementById("existing_country").value.trim();
            const code = document.getElementById("existing_countryCode").value.trim();
            const phone = document.getElementById("existing_phone").value.trim();

            if (!name || !country || !phone) {
                showDuplicate("Please fill all fields.");
                return;
            }

            const fullPhone = code + phone;

            const body = encodeForm({
                action: "registerCustomer",
                name: name,
                country: country,
                mobile: fullPhone,
                city: "",
                email: ""
            });

            try {
                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: body
                });

                const data = await response.json();

                if (data.status === "duplicate") {
                    showDuplicate(`Welcome back, ${data.name}. Redirecting…`);
                    setTimeout(() => {
                        window.location.href =
                            "search.html?name=" + encodeURIComponent(data.name);
                    }, 1500);
                } else if (data.status === "success") {
                    showDuplicate(`Welcome, ${name}. Redirecting…`);
                    setTimeout(() => {
                        window.location.href =
                            "search.html?name=" + encodeURIComponent(name);
                    }, 1500);
                } else {
                    showDuplicate("User not found. Please register.");
                }
            } catch (err) {
                showDuplicate("Network issue. Please refresh and try again.");
            }
        }

        /*---------------------------------------------------
         NEW USER REGISTRATION
        ---------------------------------------------------*/
        async function registerUser() {
            hideDuplicate();

            const name = document.getElementById("new_name").value.trim();
            const country = document.getElementById("new_country").value.trim();
            const code = document.getElementById("new_countryCode").value.trim();
            const phone = document.getElementById("new_phone").value.trim();
            const city = document.getElementById("new_city").value.trim();

            if (!name || !country || !phone || !city) {
                showDuplicate("Please fill all fields.");
                return;
            }

            const fullPhone = code + phone;

            const body = encodeForm({
                action: "registerCustomer",
                name: name,
                country: country,
                mobile: fullPhone,
                city: city,
                email: ""
            });

            try {
                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: body
                });

                const data = await response.json();

                if (data.status === "duplicate") {
                    showDuplicate(
                        `This mobile number is already registered. Welcome back, ${data.name}.`
                    );
                    setTimeout(() => {
                        window.location.href =
                            "search.html?name=" + encodeURIComponent(data.name);
                    }, 1500);
                } else if (data.status === "success") {
                    showDuplicate("Registration successful! Redirecting…");
                    setTimeout(() => {
                        window.location.href =
                            "search.html?name=" + encodeURIComponent(name);
                    }, 1500);
                } else {
                    showDuplicate("Unexpected error during registration.");
                }
            } catch (err) {
                showDuplicate("Network issue. Please refresh and try again.");
            }
        }

        /*---------------------------------------------------
         DUPLICATE / INFO BOX
        ---------------------------------------------------*/
        function showDuplicate(msg) {
            const box = document.getElementById("duplicateMsg");
            if (box) {
                box.textContent = msg;
                box.style.display = "block";
            }
        }
    </script>
</body>
</html>
