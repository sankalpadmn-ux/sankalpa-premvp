<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Sankalpa – Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="styles.css">

  <style>
    .valid-msg { color: green; font-size: 0.85rem; margin-top: 4px; }
    .error-msg { color: red; font-size: 0.85rem; margin-top: 4px; }
    .hidden { display: none; }
  </style>
</head>

<body class="bg">

  <!-- Header -->
  <header class="header" style="display:flex;justify-content:space-between;align-items:center;">
      <div class="logo2" onclick="goHome()" style="cursor:pointer;">S A N K A L P A</div>

      <nav style="display:flex;gap:22px;">
        <a href="contact.html" class="header-link">Contact Us</a>
      </nav>
  </header>

  <!-- Main Hero Section -->
  <section class="hero">
    
    <div class="left">
      <!-- IMPORTANT FIX: Correct closing tag -->
      <h1 class="hero-title">Why Sankalpa?</h1>

      <p class="hero-text">
        Sankalpa is a sacred place created to help devotees connect with the right
        Hindu priests for every ritual, ceremony, and spiritual requirement.
        Our purpose is to make the process simple, respectful, and deeply rooted
        in tradition — ensuring that every devotee finds the priest who aligns
        with their needs, values, and customs.
        <br><br>
        With purity of intention and seamless experience at heart,
        Sankalpa stands as your trusted space for divine connection.
      </p>
    </div>

    <div class="right">
      <div class="form-box">

        <!-- TOGGLE -->
        <div class="toggle-row" style="margin-top:10px;">
          <button class="primary-btn" onclick="showExisting()">Existing User</button>
          <button class="primary-btn" onclick="showNew()">New User</button>
        </div>

        <!-- ================== EXISTING USER ================== -->
        <div id="existingSection" style="display:none;margin-top:25px;">

          <div class="input-group">
            <label>Name</label>
            <input type="text" id="existing_name" placeholder="Enter Your Name">
          </div>

          <!-- Country -->
          <div class="input-group">
            <label>Country</label>
            <select id="existing_country" onchange="handleCountryChange('existing')">
              <option value="">Select Country</option>
              <option value="India" data-code="+91">India</option>
              <option value="United States" data-code="+1">United States</option>
              <option value="United Kingdom" data-code="+44">United Kingdom</option>
              <option value="Singapore" data-code="+65">Singapore</option>
              <option value="UAE" data-code="+971">UAE</option>
              <option value="Australia" data-code="+61">Australia</option>
              <option value="Canada" data-code="+1">Canada</option>
              <option value="Others">Others</option>
            </select>
          </div>

          <div class="input-group hidden" id="existing_otherCountryBox">
            <label>Enter Country</label>
            <input type="text" id="existing_otherCountry">
          </div>

          <div class="input-group">
            <label>Country Code</label>
            <input type="text" id="existing_countryCode" readonly>
          </div>

          <div class="input-group">
            <label>Mobile Number (WhatsApp)</label>
            <input type="text" id="existing_phone" placeholder="Enter Mobile Number" oninput="validateMobile('existing')">
            <div id="existing_error" class="error-msg hidden"></div>
            <div id="existing_valid" class="valid-msg hidden">✓ WhatsApp number looks valid</div>
          </div>

          <button class="primary-btn" style="width:100%;" onclick="loginUser()">Submit</button>
        </div>

        <!-- ================== NEW USER ================== -->
        <div id="newSection" style="display:none;margin-top:25px;">

          <div class="input-group">
            <label>Name</label>
            <input type="text" id="new_name" placeholder="Enter Name">
          </div>

          <!-- Country -->
          <div class="input-group">
            <label>Country</label>
            <select id="new_country" onchange="handleCountryChange('new')">
              <option value="">Select Country</option>
              <option value="India" data-code="+91">India</option>
              <option value="United States" data-code="+1">United States</option>
              <option value="United Kingdom" data-code="+44">United Kingdom</option>
              <option value="Singapore" data-code="+65">Singapore</option>
              <option value="UAE" data-code="+971">UAE</option>
              <option value="Australia" data-code="+61">Australia</option>
              <option value="Canada" data-code="+1">Canada</option>
              <option value="Others">Others</option>
            </select>
          </div>

          <div class="input-group hidden" id="new_otherCountryBox">
            <label>Enter Country</label>
            <input type="text" id="new_otherCountry" placeholder="Your Country">
          </div>

          <div class="input-group">
            <label>Country Code</label>
            <input type="text" id="new_countryCode" readonly>
          </div>

          <div class="input-group">
            <label>City</label>
            <input type="text" id="new_city" placeholder="Enter City">
          </div>

          <div class="input-group">
            <label>Email Address</label>
            <input type="email" id="email">
          </div>

          <div class="input-group">
            <label>Locality</label>
            <select id="new_locality" onchange="checkOtherLocality()">
              <option value="">Select Locality</option>
              <option>RS Puram</option>
              <option>Saibaba Colony</option>
              <option>Gandhipuram</option>
              <option>Peelamedu</option>
              <option>Ukkadam</option>
              <option>Town Hall</option>
              <option>Singanallur</option>
              <option>Ganapathy</option>
              <option>Thudiyalur</option>
              <option>Race Course</option>
              <option>Other</option>
            </select>
          </div>

          <div class="input-group" id="otherLocalityBox" style="display:none;">
            <label>Enter your locality</label>
            <input type="text" id="otherLocality">
          </div>

          <div class="input-group">
            <label>Mobile Number (WhatsApp)</label>
            <input type="text" id="new_phone" placeholder="Enter Mobile Number" oninput="validateMobile('new')">
            <div id="new_error" class="error-msg hidden"></div>
            <div id="new_valid" class="valid-msg hidden">✓ WhatsApp number looks valid</div>
          </div>

          <button class="primary-btn" style="width:100%;" onclick="registerUser()">Submit</button>

        </div>

      </div>
    </div>
  </section>

<script>

function goHome() { window.location.href = "index.html"; }

/* Toggle */
function showExisting() {
  document.getElementById("existingSection").style.display = "block";
  document.getElementById("newSection").style.display = "none";
}
function showNew() {
  document.getElementById("existingSection").style.display = "none";
  document.getElementById("newSection").style.display = "block";
}

/* Country rules */
const rules = {
  "India": { code: "+91", len: 10 },
  "United States": { code: "+1", len: 10 },
  "United Kingdom": { code: "+44", len: 10 },
  "Singapore": { code: "+65", len: 8 },
  "UAE": { code: "+971", len: 9 },
  "Australia": { code: "+61", len: 9 },
  "Canada": { code: "+1", len: 10 }
};

/* Country Change */
function handleCountryChange(type) {
  let sel = document.getElementById(type + "_country");
  let other = document.getElementById(type + "_otherCountryBox");
  let code = document.getElementById(type + "_countryCode");

  if (sel.value === "Others") {
    other.classList.remove("hidden");
    code.value = "";
  } else {
    other.classList.add("hidden");
    code.value = sel.options[sel.selectedIndex].dataset.code || "";
  }

  validateMobile(type);
}

/* WhatsApp validation */
function validateMobile(type) {
  let country = document.getElementById(type + "_country").value;
  let phone = document.getElementById(type + "_phone").value.trim();
  let err = document.getElementById(type + "_error");
  let ok = document.getElementById(type + "_valid");

  err.classList.add("hidden");
  ok.classList.add("hidden");

  if (!country || phone === "") return;

  if (country !== "Others") {
    let r = rules[country];
    if (isNaN(phone) || phone.length !== r.len) {
      err.textContent = `Invalid number for ${country}. Expected ${r.len} digits.`;
      err.classList.remove("hidden");
      return;
    }
    ok.classList.remove("hidden");

  } else {
    if (isNaN(phone)) {
      err.textContent = "Enter digits only.";
      err.classList.remove("hidden");
    } else {
      ok.classList.remove("hidden");
    }
  }
}

/* Existing User */
function loginUser() {
  let name = document.getElementById("existing_name").value.trim();
  if (name === "") {
    alert("Please enter Name and Mobile Number");
    return;
  }

  localStorage.setItem("customerName", name);
  window.location.href = "search.html";
}

/* NEW USER */
async function registerUser() {
